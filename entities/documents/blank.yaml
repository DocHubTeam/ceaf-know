# Презентация документа для его просмотра
entities:
  docs:
    presentations:
      blank:
        title: Представление документа
        params:
          title: Требуемые параметры для презентации
          type: object
          properties:
            "dh-doc-id":
              title: Идентификатор документа
              type: string
              pattern: ^[0-9a-zA-Z][a-zA-Z0-9_-]*(\.[a-zA-Z][a-zA-Z0-9_-]*)*$
          required:
            - dh-doc-id
        $constructor: >   # Конструктор позволяет создаваемый виртуальные презентации в памяти без изменений в коде
          (
            /* Доступны параметры через переменную $params */
            /* Получаем объект документа */ 
            $doc := $lookup(docs, $params."dh-doc-id");
            /* Если у документа есть свой конструктор, то выполняем его */
            $doc."$constructor" ? (
              $eval($doc."$constructor", $)
            ) : (
              /* Иначе метаданные документа берем за основу и модифицируем необходимыми свойствами */
              $merge([$doc, (
                {
                  /* Меняем базовый путь объекта. От него будут разрешаться относительные пути */
                  "$base": "/docs/" & $params."dh-doc-id" 
                }
              )]);
            )
            /* Результатом работы конструктора должна стать структура описывающая презентацию как если бы она описывалась в коде */
          )
